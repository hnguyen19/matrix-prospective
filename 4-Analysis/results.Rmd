---
title: "Effects of crop rotation on common waterhemp population dynamics: A prospective and retrospective analysis"
output:
    bookdown::word_document2:
      toc: false
      fig_caption: yes
bibliography: WH-pop-dynamics.bib
csl: apa-no-ampersand.csl 
---
```{r, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(purrr) # for map2()
library(pracma)
library(popbio)
library(tidyverse)
library(magrittr) # for %<>%
# convert this Rmd to R to source it in results.Rmd
library(flextable)
library(patchwork) #for wrap_plots
library(ggResidpanel)
library(broom)
library(nlme)
source("functions.R")
theme_set(theme_bw())
```

# Introduction {-}  

```{r, child = "../5-Report/Introduction-model.Rmd"}
```

# Materials and methods {-}

```{r, child = "../5-Report/M-and-M-model.Rmd"}
```

# Results and discussion {-}
All the multi-year variables failed the Levene's test for equal variance so those data was analyzed by year.  

## Waterhemp sub-annual demographic parameters from empirical measurement {-}

### Seedling emergence pattern and timing {-}
The empirically measured emergence rates in C4 were deemed unrealistic as compared to the published literature [], so those numbers were replaced with 0.05. The inflated emergence rates might resulted from low precision of seedbank density assessment.  

Within the same calendar year, whole-season and cohort-based seedling densities were lower in the warm-season crops than in the cool-season crops (Tables \@ref(tab:Julian-19-20-emm) and \@ref(tab:seedlings-density-19-20)). Seedling emergence was delayed in the cool-season crops as compared to that in the warm-season crops (Tables \@ref(tab:Julian-19-20-emm) and \@ref(tab:Julian-19-20-ct-tab)). Waterhemp emergence was delayed by two weeks to a month in alfalfa crop environment as compared to corn and soybean environments. Waterhemp emergence was nine to sixteen days earlier in oat than that in alfalfa.    

```{r, child= "~/Documents/Dissertation/AMATA-demography/4-Analysis/emergence-pattern-timing-Julian.Rmd"}
# diagnosis plots still look concerning
```

### 2019 soil seedbank and emergence proportion {-} 


```{r, child= "~/Documents/Dissertation/AMATA-demography/5-Report/seedbank-top-bottom.Rmd"}
# , child = "female-dens-mature.Rmd" removed because density was published
```


## Waterhemp population growth rates {-}

### Scenario 1 {-}
Using 2019 fecundity rates that were estimated from individual plant size using eighteen equations from @nguyenImpactCroppingSystem2022, waterhemp population densities were projected to decrease in all rotations, most quickly in the 2-year rotation under low herbicide corn weed management and the 3-year rotation under both corn weed management programs (Figure \@ref(fig:scenario1-phase-wise-lambda-plot)). $\lambda$'s decreased right after the first phase of the 2-year (C2) and 3-year (C3) rotations, but increased in the first phase of the 4-year rotation (C4) by three ($\lambda(C4,low)$ = 3.24) to fourteen ($\lambda(C4,low)$ = 14.34) fold. The steady decrease of population density in the soybean, oat, and alfalfa phases ($\lambda$'s = 0.5) of the 4-year rotation were sufficient to keep the rotation-wise populations decreasing within a four year cycle even if $\lambda$ increased again when the cropping system returned to the corn phase. The majority of the seedbank in the 4-year rotation was in the 2-20 cm stratum, limiting the seed pool density for seedling emergence.   

### Scenario 2 {-}

Using 2018 fecundity rates, waterhemp population densities would increase rapidly in all rotations, but most quickly in the 2-year rotation (Figure \@ref(fig:scenario2-phase-wise-lambda-plot)). The population increase in the 3-year rotation under low herbicide corn weed management was similar to that of the 4-year rotation. Even though $\lambda(r)$ were all increasing, the partition of seedbanks differed between rotations. Within the same rotation, a consistent pattern of top:bottom ratios of seed densities was observed between two corn weed management regimes. In the 2-year rotation, a large portion of the seedbanks were at the 0-2 cm soil stratum; in the 3-year rotation, the top and bottom soil strata were fairly evenly populated; and in the 4-year rotation, the majority of the seedbanks were at the bottom stratum.   

The oat phase of the 3-year rotation (O3) and the alfalfa phase of the 4-year rotation (A4) offered opportunities for decreasing $\lambda$, which was not possible in any other crop phases in the three examined rotations. However, the declines in $\lambda(r)$'s in O3 ($\lambda(O3,low)$ = 0.68) and A4 ($\lambda(A4,low)$ = 0.60) were not strong enough to deplete the replenishment from the corn ($\lambda(C3,low)$ = 2553 and $\lambda(C4,low)$ = 35676.54) and soybean phases ($\lambda(S3,low)$ = 14567.90 and $\lambda(S4,low)$ = 30.20). 

## Elasticities of popilation growth rates to lower-level demographic parameters {-}

All the relative ranking of elasticity of $\lambda$ to the lower-level demographic parameters was consistent between corn weed management regimes (Figures \@ref(fig:scenario1-E-B-by-rot-rank) and \@ref(fig:scenario2-E-B-by-rot-rank)). However, the overall population change rate can be reflected by the relative importance of each $b_{ij}$ element on the elasticity of $\lambda$. 

Even though all the $B_h$ matrices, but $B_f$, were identical across scenarios, the ranking of each $b_{ij}$ element contribution to the elasticity of $\lambda$ might be slightly different across scenarios. For example, the the $\lambda$-decreasing case, the relative ranks of $t_{22_s}$ (the probability that a seed in the 2-20 cm stratum stay at that stratum) was higher that those of other $t_{ij_s}$, whereas $t_{22_s}$ in the population-growing case was the lowest among all $t_{ij_s}$. Similarly, $s_{s2}$ was more important than $s_{s1}$ in the elasticity of $\lambda$ in the population-shrinking versus population-growing case. Consistent patterns in the importance of $t_{ij_f}$ to elasticity of $\lambda$ was observed in the two scenarios.  

Because seed emergence and seedling survival rate contributed minimally to the elasticity of $\lambda$, this pattern suggests that even if weed control programs are of high, or even total efficacy, very few survived plants prolifically producing new seeds, can sustain the population. The low relative importance of $g_k$ and $s_{p_k}$ can be attributed to the low emergence rate in weeds, the high weed control efficacy, while the high relative importance of of $f_k$ to elasticity of $\lambda$ can be explained by the high individual fecundity.

In both scenarios, the patterns of contribution to elasticity of $\lambda$ in the 3-year rotation was slightly different from the 2-year and 4-year rotations. The contribution of plant survival rate to elasticity of $\lambda$ was non-existent in C2, S2, C4, S4, and O4 (absolute zeros) but minimal in C3, S3, and O4 (very small positive values). The difference in contribution of plant survival rate on O3 and O4 might be attributed to the different companion crops to oat (red clover in O3 and alfalfa in O4). 

### Scenario 1 {-}  
The ranking of parameters or individual parameters to the elasticity of $\lambda_r$ differed by rotation and crop phase (Figure \@ref(fig:scenario1-E-B-by-rot-rank)). The seed preserving parameters were ranked higher in the corn phase of the 3-year rotation (C3) under both weed management regimes, the soybean phase of the 3-year rotation (S3) that followed corn under low herbicide weed management, the oat phases of the 3-year and 4-year rotations (O3 and O4) regardless of the preceding corn phase's weed management regime, and the alfalfa phase of the 4-year rotation (A4) regardless of the preceding corn phase's weed management regime. The seed producing parameters were ranked higher in the other crop environments (crop species in each rotation).  

The elasticity of $\lambda(r)$ to fecundity rate, as a group, were ranked first in the corn phase of the 2-year rotation (C2) (43.13 and 3.15), the soybean phase of the 2-year rotation (S2) (0.75 and 4.18), the soybean phase of the 3-year rotation (S3) that followed corn under low herbicide weed management program (0.91), the corn phase of the 4-year rotation (C4) (305.24 and 323.07), and the alfalfa in the 4-year rotation (A4) (36.78 and 14.49) under both weed management regimes.
The rate of pre-planting tillage induced seed movement to the 2-20 cm soil stratum was the first-ranked individual parameter to the elasticity of $\lambda(r)$'s in the corn phase of the 3-year rotation (C3) (1.1 and 1.1), the soybean in the 3-year rotation that followed corn under low herbicide weed management (0.89), the oat phase of the 3-year rotation (O3) (0.87 and 0.88), and the oat phase of the 4-year rotation (5.49 and 3.98). The overwinter survival rate of the seeds in the 0-2 cm soil stratum was the first-ranked individual parameter to the elasticity of $\lambda(r)$'s in the soybean phase of the 4-year rotation (S4) (3.32 and 2.41). 

As $\lambda(r)$s declined in this scenario, with some opportunity of increasing in the C4 phase, focusing on reducing plant fecundity in C4 would sufficiently stabilize $\lambda(4)$, provided that the weed control efficacy in the subsequent three crop phases remained adequate. 


### Scenario 2 {-}  

Unlike Scenario 1's dynamics, the differences in the absolute value of the elasticity of $\lambda_r$ to the first-ranked and second-ranked groups of parameters were multiple orders of magnitude. The seed producing parameters were ranked higher in all crop environments (crop species in each rotation).   

The elasticity of $\lambda(r)$'s to fecundity rates, as a group, were ranked first in all crop phases (Figure \@ref(fig:scenario2-E-B-by-rot-rank)). The elasticity of $\lambda$'s to cohort one fecundity were the highest in C2 (4.1 x $10^9$ and 2.8 x $10^9$), S3 (4.4 x $10^9$ and 9.7 x $10^{10}$), and O4 (8.3 x $10^6$ and 6.5 x $10^6$) phases. The elasticity of $\lambda_r$'s elasticity to cohort two fecundity were the highest in S2 (1.4 x $10^{10}$ and 8.4 x $10^9$), C3 (1 x $10^{10}$ and 1 x $10^9$), O3 (3 x $10^8$ and 2.5 x $10^7$), C4 (1.6 x $10^9$ and 1 x $10^{10}$), S4 (8.4 x $10^7$ and  8.8 x $10^7$), and A4 (1.1 x $10^7$ and  3 x $10^5$) phases.  

The second-ranked group of demographic parameters to $\lambda_r$ differed by rotation and crop phase. In the 2-year rotation, the second-ranked group of parameters in contribution to the elasticity of $\lambda(2)$ were both pre-planting tillage-induced seed movement and overwinter seed survival. In the 3-year rotation, the second-ranked group of parameters in contribution to elasticity of $\lambda(3)$ was pre-planting tillage-induced seed movement in the warm-season crop phases; and overwinter seed survival in the cool-season crop phase. In the 4-year rotation, the second-ranked group of parameters in contribution to elasticity of $\lambda(4)$ was overwinter seed survival in the cool-season crop phase and pre-planting tillage-induced seed movement in the warm-season crop phases; a reverse trend as compared to the 3-year rotation's dynamics.




```{r, child = "prospective-dynamics-rotation-wise-projection-scenario1.Rmd"}
```


```{r, child = "prospective-dynamics-rotation-wise-projection-scenario2.Rmd"}
```

## Conclusion {-}

*Delayed (Table \@ref(tab:Julian-19-20-tab)) but steady emergence \@ref(tab:seedlings-density-19-20) in the cool-season crop environments decreased population fecundity in the oat and alfalfa phases, and thus, accelerated seedbank size reduction in scenario 1 and slowed seedbank size increment in scenario 2.*  

The cohort-based female survival rates at the experiment site were not realistically estimated due to small sample size in a high-efficacy weed management program. Future experiments should focus on assessing cohort-based female survival rates in cool-season crop environments. 

The hypothesis that "extending a conventional 2-year rotation of corn and soybean with cool-season crops can accelerate soil seedbank depletion" was supported. The findings here illustrated that employing the "many little hammers" concept could provide effective control of common waterhemp [@liebmanManyLittleHammers1997]. Unlike giant foxtail whose bottle neck point in the life cycle was overwinter seed survival rate [@davisCroppingSystemEffects2002], waterhemp's bottle neck point in its life cycle was seedling emergence rate and seedling to maturity success rate. However, if the early emerged plants were unaffected by weed control programs, either through herbicide resistance or escape from cultivation, and successfully complete their life cycle, a small number of large, prolific female plants would sufficiently replenish the soil seedbank.  

Since the elasticity of $\lambda$ was the least affected by seedling emergence in both the population-growing and population-shrinking scenarios, it would be helpful to focus on disrupting seed production by reducing individual plant size with delaying emergence or applying multiple stress factors to successfully establishing plants, and by limiting seed deposit to the soil. Under the current 4-year rotation's crop sequence, oat (O4) and alfalfa (A4) provided valuable opportunities to reduce plant size [@nguyenWeedCommunityComposition2022; @nguyenImpactCroppingSystem2022]. 

A reduction in the mass of applied herbicide active ingredients [@nguyenWeedCommunityComposition2022] was not coincident with population declining in the Scenario 1 ($\lambda < 1$) but did coincide with population growing in scenario 2 ($\lambda > 1$). In consideration of Scenario 2, population-growing, it would be useful to examine how many years of continuous overwinter cover crops would be necessary and which cool-season crop species would be most efficient in decreasing waterhemp $\lambda$ after steady seedbank replenishment. Such an investigation is needed because even if the increased abundance of waterhemp and other weed species has not been observed at the experiment site [@nguyenWeedCommunityComposition2022], an abundant seedbank of a highly competitive weed species harbors risks of weed outbreaks. 



## Appendix {-}

### Seed densities at the top and bottom soil strata {-}  

```{r, echo=TRUE}
## ANOVA of Crop ID x Corn weed management effects on AMATA seedbank density at the 0-2 cm soil stratum
AMATA_female_top_lm <- lm(log(AMATA_total_viable_density + 1) ~ Block + 
                     Crop_ID * Corn_weed_management, 
                   data = top_stratum_female)


## ANOVA table of female seedbank density at the 0-2 cm soil stratum
AMATA_female_top_emm_log <- emmeans(AMATA_female_top_lm, 
                                    c("Crop_ID" , "Corn_weed_management"))

joint_tests(AMATA_female_top_emm_log )
```

```{r, echo=TRUE}
## ANOVA of Crop ID x Corn weed management effects on AMATA seedbank density at the 2-20 cm soil stratum
AMATA_female_bottom_lm <- lm(log(AMATA_total_viable_density + 1) ~ Block + 
                     Crop_ID * Corn_weed_management, 
                   data = bottom_stratum_female)
 

## ANOVA table of female seedbank density at the 2-20 cm soil stratum
AMATA_female_bottom_emm_log <- emmeans(AMATA_female_bottom_lm, c("Crop_ID" , "Corn_weed_management"))

joint_tests(AMATA_female_bottom_emm_log)
```

```{r, echo=FALSE, fig.cap = "Diagnosis plots for the effects of crop identity and crop weed managennt on the seedbank densities at the top (A) and bottom (B) soil strata"}

list(AMATA_female_top_lm, AMATA_female_bottom_lm) %>%
   lapply(resid_panel, nrow = 4) %>% 
  wrap_plots() +
  plot_annotation(tag_levels = "A")
```

### Emergence pattern and timing in different crop environments {-}


```{r, echo = TRUE}
## Did crop identity and corn weed management affect waterhemp's emergence pattern in 2019?
emerge_cohort_19_gls <- gls(log(Density_end_female_eu_cohort+1)  ~ Block + 
                   Crop_ID*Corn_weed_management + Cohort +
                   Crop_ID:Cohort + Corn_weed_management:Cohort,
                 correlation=corCompSymm(form=~1 | bt),
                 weights=varIdent(form= ~1 | Cohort),
data=cohort_emergence_female_19)

 joint_tests(emerge_cohort_19_gls)
```

```{r, echo = TRUE}
## Did crop identity and corn weed management affect waterhemp's emergence pattern in 2020?
# 
emerge_cohort_20_gls <- gls(log(cohort_female_Seedling_density +1)  ~ Block + 
                   Crop_ID*Corn_weed_management + Cohort +
                   Crop_ID:Cohort + Corn_weed_management:Cohort,
                 correlation=corCompSymm(form=~1 | bt),
                 weights=varIdent(form= ~1 | Cohort),
data=cohort_emerge_20_first_six )

 joint_tests(emerge_cohort_20_gls)
```


```{r, echo = TRUE}
## Did crop identity and corn weed management affect waterhemp's first emergence timing in 2019?
Julian_cohort1_19_lm <- lm(Julian_day  ~ Block + 
                         Crop_ID*Corn_weed_management,
data = cohort1_2019_eu ) 

joint_tests(Julian_cohort1_19_lm)
```

```{r, echo = TRUE}
## Did crop identity and corn weed management affect waterhemp's first emergence timing in 2020?
Julian_cohort1_20_lm <- lm(Julian_day ~ Block + 
                         Crop_ID*Corn_weed_management,
                         data=cohort1_2020)

joint_tests(Julian_cohort1_20_lm )
```


```{r, echo=FALSE, fig.cap = "Diagnosis plots for the effects of crop identity and corn weed management on the seedbank densities at the top (A) and bottom (B) soil strata"}
list(Julian_cohort1_19_lm, Julian_cohort1_20_lm) %>%
   lapply(resid_panel, nrow = 4) %>% 
  wrap_plots() +
  plot_annotation(tag_levels = "A")
```


```{r emerge-pattern-19, echo=FALSE, fig.cap= "Diagnosis plot for the effects of crop identity, corn weed management, and cohort on seedling densities in 2019"}

plot(emerge_cohort_19_gls, resid(., type = "p") ~ fitted(.)) 
```


```{r emerge-pattern-20, echo=FALSE, fig.cap= "Diagnosis plot for the effects of crop identity, corn weed management, and cohort on seedling densities in 2020"}
plot(emerge_cohort_20_gls, resid(., type = "p") ~ fitted(.))

```



### 2019 female survival rate by cohort {-}

```{r, child= "~/Documents/Dissertation/AMATA-demography/4-Analysis/female-survival-point-est-2019.Rmd"}
# , child = "female-dens-mature.Rmd" removed because density was published
```

### Matrix assembly {-}

```{r, child= "../5-Report/Appendix-matrices-list.Rmd"}

```


# References {-}